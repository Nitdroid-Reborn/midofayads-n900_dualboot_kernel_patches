Index: kernel-2.6.28/drivers/power/bq27x00_battery.c
===================================================================
--- kernel-2.6.28.orig/drivers/power/bq27x00_battery.c	2010-06-30 12:12:50.000000000 +0400
+++ kernel-2.6.28/drivers/power/bq27x00_battery.c	2010-06-30 12:50:58.000000000 +0400
@@ -34,6 +34,8 @@
 #define BQ27x00_REG_AI			0x14
 #define BQ27x00_REG_FLAGS		0x0A
 
+#define BQ27000_FLAG_CHGS		BIT(7)
+
 /* If the system has several batteries we need a different name for each
  * of them...
  */
@@ -60,7 +62,10 @@
 };
 
 static enum power_supply_property bq27x00_battery_props[] = {
+	POWER_SUPPLY_PROP_HEALTH,
 	POWER_SUPPLY_PROP_PRESENT,
+	POWER_SUPPLY_PROP_STATUS,
+	POWER_SUPPLY_PROP_TECHNOLOGY,
 	POWER_SUPPLY_PROP_VOLTAGE_NOW,
 	POWER_SUPPLY_PROP_CURRENT_NOW,
 	POWER_SUPPLY_PROP_CAPACITY,
@@ -97,7 +102,7 @@
 		return ret;
 	}
 
-	return (temp >> 2) - 273;
+	return ((temp >> 2) - 273) * 10;
 }
 
 /*
@@ -164,6 +169,28 @@
 	return rsoc >> 8;
 }
 
+static int bq27x00_battery_status(struct bq27x00_device_info *di,
+				  union power_supply_propval *val)
+{
+	int flags = 0;
+	int status;
+	int ret;
+
+	ret = bq27x00_read(BQ27x00_REG_FLAGS, &flags, 0, di);
+	if (ret < 0) {
+		dev_err(di->dev, "error reading flags\n");
+		return ret;
+	}
+
+	if (flags & BQ27000_FLAG_CHGS)
+		status = POWER_SUPPLY_STATUS_CHARGING;
+	else
+		status = POWER_SUPPLY_STATUS_DISCHARGING;
+
+	val->intval = status;
+	return 0;
+}
+
 #define to_bq27x00_device_info(x) container_of((x), \
 				struct bq27x00_device_info, bat);
 
@@ -189,6 +216,14 @@
 	case POWER_SUPPLY_PROP_TEMP:
 		val->intval = bq27x00_battery_temperature(di);
 		break;
+	case POWER_SUPPLY_PROP_TECHNOLOGY:
+		val->intval = POWER_SUPPLY_TECHNOLOGY_LION;
+		break;
+	case POWER_SUPPLY_PROP_HEALTH:
+		val->intval = POWER_SUPPLY_HEALTH_GOOD;
+		break;
+	case POWER_SUPPLY_PROP_STATUS:
+		return bq27x00_battery_status(di, val);
 	default:
 		return -EINVAL;
 	}
@@ -358,6 +393,22 @@
 	.id_table = bq27200_id,
 };
 
+struct bq27200_platform_data {
+	int dummy;
+};
+
+static struct bq27200_platform_data bq27200_config = {
+	.dummy = 0,
+};
+
+static struct i2c_board_info rx51_camera_board_info_2 =
+	{
+		I2C_BOARD_INFO("bq27200", 0x55),
+		.platform_data = &bq27200_config,
+	};
+
+static struct i2c_client *client;
+
 static int __init bq27x00_battery_init(void)
 {
 	int ret;
@@ -365,6 +416,7 @@
 	ret = i2c_add_driver(&bq27200_battery_driver);
 	if (ret)
 		printk(KERN_ERR "Unable to register BQ27200 driver\n");
+	client = i2c_new_device(i2c_get_adapter(2), &rx51_camera_board_info_2);
 
 	return ret;
 }
