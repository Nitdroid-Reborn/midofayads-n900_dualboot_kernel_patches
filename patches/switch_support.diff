Index: kernel-2.6.28/arch/arm/mach-omap2/board-rx51-peripherals.c
===================================================================
--- kernel-2.6.28.orig/arch/arm/mach-omap2/board-rx51-peripherals.c	2010-06-15 03:41:47.000000000 +0400
+++ kernel-2.6.28/arch/arm/mach-omap2/board-rx51-peripherals.c	2010-06-15 19:01:55.000000000 +0400
@@ -23,6 +23,7 @@
 #include <linux/delay.h>
 #include <linux/lis302dl.h>
 #include <linux/leds-lp5523.h>
+#include <linux/switch.h>
 
 #include <asm/mach-types.h>
 
@@ -265,10 +266,23 @@
 	},
 };
 
+static struct gpio_switch_platform_data headset_switch_data = {
+       .name = "h2w",
+       .gpio = OMAP_MAX_GPIO_LINES + 177,        /*TWL4030 GPIO_177 */
+};
+
+static struct platform_device headset_switch_device = {
+       .name             = "h2w",
+       .dev = {
+               .platform_data    = &headset_switch_data,
+       }
+};
+
 static struct platform_device *rx51_peripherals_devices[] = {
 	&rx51_smc91x_device,
 	&rx51_camera_button_device,
 	&rx51_lirc_device,
+	&headset_switch_device,
 };
 
 static void __init rx51_init_smc91x(void)
Index: kernel-2.6.28/drivers/switch/switch_gpio.c
===================================================================
--- kernel-2.6.28.orig/drivers/switch/switch_gpio.c	2010-06-15 18:00:16.000000000 +0400
+++ kernel-2.6.28/drivers/switch/switch_gpio.c	2010-06-15 18:02:31.000000000 +0400
@@ -112,7 +112,8 @@
 	}
 
 	ret = request_irq(switch_data->irq, gpio_irq_handler,
-			  IRQF_TRIGGER_LOW, pdev->name, switch_data);
+			  IRQF_TRIGGER_RISING | IRQF_TRIGGER_FALLING,
+			  pdev->name, switch_data);
 	if (ret < 0)
 		goto err_request_irq;
 
